#include "GyverPWM.h"
#define intAR 2
#define intBR 3
#define intAL 4
#define intBL 5

#define PWM1 10

void up (uint8_t speeds, uint8_t usped) {
  static uint16_t timer = millis();
  bool flag_s;
  digitalWrite(intAR, HIGH);
  digitalWrite(intBR, LOW);
  digitalWrite(intAL, HIGH);
  digitalWrite(intBL, LOW);
  if (millis() - timer >= usped && flag_s == 0) {
    timer = millis();
    for (uint8_t i; i < speeds; i++) {
      PWM_set(PWM1, i);
      Serial.println(i);
      if (speeds - i == 1) {
        flag_s = !flag_s;
      }
    }
  }
  if (flag_s == 1) {
    Serial.println(speeds);
    analogWrite(PWM1,speeds);
  }
}


void setup() {
  Serial.begin(9600);
  pinMode(intAR, OUTPUT);
  pinMode(intBR, OUTPUT);
  pinMode(intAL, OUTPUT);
  pinMode(intBL, OUTPUT);


  pinMode(PWM1, OUTPUT);


  // Данные функции убирают один ШИМ выход у 8-ми битных таймеров, оставляя нам ШИМ пины D3, D5, D9 и D10 на ATmega328
  // запустить ШИМ на D9 с частотой 150'000 Гц, режим FAST_PWM
  PWM_frequency(PWM1, 180000, FAST_PWM);
  // запустить ШИМ на D10 с частотой 150'000 Гц, режим FAST_PWM
  PWM_frequency(PWM1, 180000, FAST_PWM);
  // пины 9 и 10 работают на одной частоте, запустить на разных не получится!
}



void loop() {
  uint8_t speedpot =  map(analogRead(A0),0,1023,0,127;
  uint8_t uspeedpot = analogRead(A1) /4;
  up(speedpot, uspeedpot);

}
